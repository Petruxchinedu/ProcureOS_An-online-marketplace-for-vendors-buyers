{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/bless/OneDrive/Desktop/BULK-BUY-ENETRPRISE/frontend/bulk-buy-frontend/app/buyer/invoice/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\r\nimport { api } from \"@/lib/api\";\r\nimport { \r\n  FileText, Download, CreditCard, Printer, \r\n  ArrowLeft, ShieldCheck, Lock, Loader2 \r\n} from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { toast } from \"react-hot-toast\";\r\n\r\nexport default function BuyerInvoicePage() {\r\n  const { id } = useParams();\r\n  const router = useRouter();\r\n\r\n  const { data: rfq, isLoading } = useQuery({\r\n    queryKey: [\"invoice\", id],\r\n    queryFn: async () => {\r\n      const res = await api.get(`/rfq/${id}`);\r\n      return res.data;\r\n    }\r\n  });\r\n\r\n  // Handle the actual payment transition\r\n  const executePayment = useMutation({\r\n    mutationFn: async () => {\r\n      // In a real app, this would happen after Stripe/PayPal success callback\r\n      return await api.patch(`/rfq/${id}/status`, { status: \"PAID\" });\r\n    },\r\n    onSuccess: () => {\r\n      toast.success(\"Payment Secured in Escrow\");\r\n      router.push(`/buyer/rfq/${id}/success`); // Redirect to a success/thank you page\r\n    }\r\n  });\r\n\r\n  if (isLoading) return (\r\n    <div className=\"min-h-[60vh] flex flex-col items-center justify-center\">\r\n      <Loader2 className=\"animate-spin text-blue-600 mb-4\" size={40} />\r\n      <p className=\"font-black text-slate-400 uppercase tracking-widest text-xs\">Generating Ledger Entry...</p>\r\n    </div>\r\n  );\r\n\r\n  // SENIOR LOGIC: Priority Price Selection\r\n  // If there's a counter price, use it. Otherwise, use target price.\r\n  const finalUnitPrice = rfq.vendorCounterPrice || rfq.targetUnitPrice;\r\n  const subtotal = rfq.quantity * finalUnitPrice;\r\n  const platformFee = subtotal * 0.03; // Professional B2B platforms use service fees\r\n  const total = subtotal + platformFee;\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto py-12 px-6\">\r\n      <div className=\"flex justify-between items-center mb-8\">\r\n        <Link href={`/buyer/rfq/${id}`} className=\"flex items-center text-slate-500 hover:text-blue-600 font-bold transition-colors\">\r\n          <ArrowLeft size={18} className=\"mr-2\" /> Back to Negotiation\r\n        </Link>\r\n        <div className=\"flex gap-3\">\r\n            <button onClick={() => window.print()} className=\"p-2 hover:bg-slate-100 rounded-full transition-all text-slate-400\">\r\n                <Printer size={20} />\r\n            </button>\r\n            <button className=\"p-2 hover:bg-slate-100 rounded-full transition-all text-slate-400\">\r\n                <Download size={20} />\r\n            </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-white shadow-[0_32px_64px_-12px_rgba(0,0,0,0.1)] rounded-3xl border border-slate-100 overflow-hidden\">\r\n        {/* Top Trust Banner */}\r\n        <div className=\"bg-blue-600 px-12 py-3 flex justify-center items-center gap-3\">\r\n           <ShieldCheck size={14} className=\"text-white\" />\r\n           <span className=\"text-[10px] font-black text-white uppercase tracking-[0.2em]\">Transaction Protected by ProcureOS Escrow</span>\r\n        </div>\r\n\r\n        {/* Invoice Header */}\r\n        <div className=\"p-12 border-b border-slate-50 flex justify-between items-start\">\r\n          <div>\r\n            <h1 className=\"text-5xl font-[1000] text-slate-900 tracking-tighter italic\">INVOICE</h1>\r\n            <p className=\"text-slate-400 font-bold mt-2 uppercase text-[10px] tracking-[0.3em]\">REF: {rfq._id.slice(-12).toUpperCase()}</p>\r\n          </div>\r\n          <div className=\"text-right\">\r\n            <div className=\"bg-slate-900 text-white px-4 py-2 rounded-lg inline-block font-black text-sm italic mb-2\">\r\n                BULKBUY<span className=\"text-blue-500\">.OS</span>\r\n            </div>\r\n            <p className=\"text-slate-400 text-[10px] font-black uppercase tracking-widest leading-tight\">Official Marketplace<br/>Record</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Participant Info */}\r\n        <div className=\"grid grid-cols-2 p-12 gap-20 border-b border-slate-50\">\r\n          <div className=\"space-y-4\">\r\n            <p className=\"text-[10px] font-black text-blue-600 uppercase tracking-widest\">Remit To (Vendor)</p>\r\n            <div>\r\n                <p className=\"text-xl font-black text-slate-900\">{rfq.vendorId?.name || \"Verified Partner\"}</p>\r\n                <p className=\"text-slate-500 text-sm font-medium mt-1\">Authorized Fulfillment Center</p>\r\n            </div>\r\n          </div>\r\n          <div className=\"text-right space-y-4\">\r\n            <p className=\"text-[10px] font-black text-blue-600 uppercase tracking-widest\">Billed To (Buyer)</p>\r\n            <div>\r\n                <p className=\"text-xl font-black text-slate-900\">{rfq.buyerId?.name}</p>\r\n                <p className=\"text-slate-500 text-sm font-medium mt-1\">{rfq.buyerId?.email}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Line Items */}\r\n        <div className=\"p-12\">\r\n          <table className=\"w-full\">\r\n            <thead>\r\n              <tr className=\"text-left border-b border-slate-100\">\r\n                <th className=\"pb-6 text-[10px] font-black text-slate-400 uppercase tracking-widest\">Contract Description</th>\r\n                <th className=\"pb-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center\">Volume</th>\r\n                <th className=\"pb-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right\">Unit Rate</th>\r\n                <th className=\"pb-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right\">Amount</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr>\r\n                <td className=\"py-8\">\r\n                  <p className=\"font-black text-slate-900 text-lg leading-none\">{rfq.productId?.name}</p>\r\n                  <p className=\"text-xs text-slate-400 font-bold mt-2 uppercase tracking-tighter italic\">Bulk Fulfillment Order</p>\r\n                </td>\r\n                <td className=\"py-8 text-center font-bold text-slate-700\">{rfq.quantity.toLocaleString()}</td>\r\n                <td className=\"py-8 text-right font-bold text-slate-700\">${finalUnitPrice.toLocaleString()}</td>\r\n                <td className=\"py-8 text-right font-[1000] text-slate-900 text-lg\">${subtotal.toLocaleString()}</td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n\r\n          {/* Totals Section */}\r\n          <div className=\"mt-12 pt-12 border-t border-slate-100 flex justify-end\">\r\n            <div className=\"w-72 space-y-4\">\r\n              <div className=\"flex justify-between items-center text-slate-500\">\r\n                <span className=\"text-[10px] font-black uppercase tracking-widest\">Merchandise Subtotal</span>\r\n                <span className=\"font-bold\">${subtotal.toLocaleString()}</span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center text-slate-500\">\r\n                <span className=\"text-[10px] font-black uppercase tracking-widest\">Platform Service (3%)</span>\r\n                <span className=\"font-bold\">${platformFee.toLocaleString()}</span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center pt-6 border-t-2 border-slate-900\">\r\n                <span className=\"text-xs font-[1000] uppercase tracking-tighter text-slate-900\">Grand Total (USD)</span>\r\n                <span className=\"text-4xl font-[1000] text-blue-600 tracking-tighter italic\">${total.toLocaleString()}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer Actions */}\r\n        <div className=\"p-10 bg-slate-50 border-t border-slate-100 flex flex-col md:flex-row gap-6 items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n                <div className=\"w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-blue-600 shadow-sm border border-slate-100\">\r\n                    <Lock size={20} />\r\n                </div>\r\n                <div>\r\n                    <p className=\"text-[10px] font-black text-slate-900 uppercase tracking-widest mb-0.5\">Escrow Guarantee</p>\r\n                    <p className=\"text-[10px] text-slate-400 font-bold leading-tight uppercase\">Funds are held by BulkBuy until<br/>shipment is verified by you.</p>\r\n                </div>\r\n            </div>\r\n            \r\n            <button \r\n              onClick={() => executePayment.mutate()}\r\n              disabled={executePayment.isPending}\r\n              className=\"w-full md:w-auto px-12 py-5 bg-slate-900 text-white font-[1000] rounded-2xl hover:bg-blue-600 transition-all flex items-center justify-center gap-3 shadow-xl uppercase text-xs tracking-[0.2em] group\"\r\n            >\r\n              {executePayment.isPending ? (\r\n                  <Loader2 className=\"animate-spin\" />\r\n              ) : (\r\n                <>\r\n                    <CreditCard size={18} className=\"group-hover:scale-110 transition-transform\" />\r\n                    Authorize & Secure Funds\r\n                </>\r\n              )}\r\n            </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}